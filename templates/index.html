<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cocktail Blog</title>

    <link href="https://fonts.googleapis.com/css?family=Exo:400,500,600,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- include libraries(jQuery, bootstrap) -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>

    <!-- include summernote css/js -->
    <link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote.css" rel="stylesheet">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote.js"></script>

    <link rel="stylesheet" href="../static/stylesheet/main.css">
</head>
<body>
<div class="nav">

    <div class="nav__details">

        <div class="nav__details__header">
            <h1 class="nav__details__header-text">Cocktail Blog</h1>
        </div>

        <div class="nav__details__btn">
            <a href="#" class="nav__details__btn-ingr nav__details__btn-decor">Ingredients</a>
            <a href="#" class="nav__details__btn-list nav__details__btn-decor">List</a>
            <a href="#" class="nav__details__btn-about nav__details__btn-decor">About</a>
            <a href="#" class="nav__details__btn-cont nav__details__btn-decor">Contact Us</a>
        </div>

        <div class="nav__details__search">
            <form class="nav__details__search-form">
                <input class="nav__details__search-box" type="text" id="mySearch" name="q"
                       placeholder="Search the site...">
                <button class="nav__details__search-btn" type="submit"><i class="fa fa-search"></i></button>
            </form>
        </div>
    </div>

    <div class="nav__logo">
        <img src="/static/img/logo-small.svg" class="nav__logo-pic"
             alt="logo picture with cock who drinks cocktail">
    </div>
</div>

<div class="tags">

    <div class="tags__primary">
        <h2 class="tags__primary-text">All that you want to know about cocktails</h2>
    </div>

    <div class="tags__list">
        <ul class="tags__list__box">
            <li class="tags__list__box-1"><a class="tags__list__box-decor" href="#">#vodka</a></li>
            <li class="tags__list__box-2"><a class="tags__list__box-decor" href="#">#rum</a></li>
            <li class="tags__list__box-3"><a class="tags__list__box-decor" href="#">#martini</a></li>
            <li class="tags__list__box-4"><a class="tags__list__box-decor" href="#">#sweet</a></li>
            <li class="tags__list__box-5"><a class="tags__list__box-decor" href="#">#sour</a></li>
            <li class="tags__list__box-6"><a class="tags__list__box-decor" href="#">#whisky</a></li>
            <li class="tags__list__box-7"><a class="tags__list__box-decor" href="#">#red</a></li>
            <li class="tags__list__box-8"><a class="tags__list__box-decor" href="#">#sex on the beach</a></li>
            <li class="tags__list__box-9"><a class="tags__list__box-decor" href="#">#lime</a></li>
            <li class="tags__list__box-10"><a class="tags__list__box-decor" href="#">#mint</a></li>
        </ul>
    </div>

</div>

<div class="article"></div>

<div class="paginations">
    <a href="#" class="paginations__btn" id="prev" onclick="previousPage()">previous</a>
    <a href="#" class="paginations__btn" id="next" onclick="nextPage()">next</a>
</div>

<script>
    $(document).ready(function () {
        let url = new URL(window.location);
        let query_string = url.search;
        let search_params = new URLSearchParams(query_string);
        let search_str = search_params.toString();
        $.ajax({
            url: '/articles' + ((search_str.length === 0)?"":("?" + search_str)),
            type: 'GET',
            dataType: "json",
            success: function (data) {
                let articles = data["articles"];

                $(articles).each(function () {
                    let id = this.id;
                    let title = this.title;
                    let creationTime = this.creation_time;
                    let body = this.body;
                    let ingredients = this.ingredients;
                    let tags = this.tags;

                    $(".article").append(`<div id=${id} class='article__container'></div>`);

                    let idSelector = $('#' + id);
                    idSelector.append(`<h2 class='article__container__header'>${title}</h2>`);
                    idSelector.append(`<p class='article__container__creationTime'>${creationTime}</p>`);
                    idSelector.append(`<div class='article__container__body'>${body}</div>`);
                    idSelector.append(`<ul class='article__container__tags'>Tags:</ul>`);

                    let tagsSelector = $('#' + id + `>.article__container__tags`);
                    ingredients.forEach(function (ingredient) {
                        tagsSelector.append(`<li class='article__container__tags__elem'>${ingredient}</li>`);
                    });
                    tags.forEach(function (tag) {
                        tagsSelector.append(`<li class='article__container__tags__elem'>${tag}</li>`);
                    });
                })
            },
            error: function () {
                alert('ERROR');
            }
        });

        if (query_string ==="" ||  query_string ==="?offset=0") {
            let hidden = document.getElementById("prev");
            hidden.className += " paginations__hidden";
        }
    });

</script>

<script>

    function previousPage() {
        let url = new URL(window.location);
        let query_string = url.search;
        let search_params = new URLSearchParams(query_string);
        if (search_params.has("offset")) {
            search_params.set('offset', parseInt(search_params.get('offset')) - 5);
        }
        window.location.href =  '?' + search_params.toString();
    }

    function nextPage() {
        let url = new URL(window.location);
        let query_string = url.search;
        let search_params = new URLSearchParams(query_string);
        if (search_params.has("offset")) {
            search_params.set('offset', parseInt(search_params.get('offset')) + 5);
        }
        else {
            search_params.set("offset", '5');
        }
        window.location.href =  '?' + search_params.toString();
    }

</script>

</body>
</html>